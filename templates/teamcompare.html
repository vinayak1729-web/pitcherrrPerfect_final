<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Team Comparison</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
            /* Font Import */
            @import url('https://fonts.googleapis.com/css2?family=Bungee&display=swap');

            :root {
                --mlb-blue: #002D72;
                --mlb-red: #E31837;
                --neo-black: #000000;
                --neo-white: #ffffff;
                --neo-shadow: 8px 8px 0px rgba(0, 0, 0, 0.9);
            }

            body {
                font-family: 'Bungee', cursive;
                background: repeating-linear-gradient(
                    45deg,
                    #1a1a1a,
                    #1a1a1a 10px,
                    #222 10px,
                    #222 20px
                );
                color: var(--neo-white);
                margin: 0;
                padding: 40px;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: #2a2a2a;
                padding: 40px;
                border: 4px solid var(--neo-black);
                box-shadow: var(--neo-shadow);
            }

            .header {
                background: linear-gradient(90deg, var(--mlb-blue), var(--mlb-red));
                padding: 20px;
                margin: -40px -40px 40px -40px;
                border-bottom: 4px solid var(--neo-black);
            }

            .header h1 {
                font-size: 3rem;
                text-transform: uppercase;
                text-shadow: 4px 4px 0px var(--neo-black);
                letter-spacing: 2px;
                margin: 0;
                text-align: center;
            }

            .team-select-container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 40px;
                margin-bottom: 40px;
            }

            .team-select {
                background: var(--neo-white);
                color: var(--neo-black);
                padding: 30px;
                border: 4px solid var(--neo-black);
                box-shadow: var(--neo-shadow);
                transform: rotate(-1deg);
            }

            .team-select:nth-child(2) {
                transform: rotate(1deg);
            }

            .team-select h2 {
                color: var(--neo-black);
                text-transform: uppercase;
                margin-top: 0;
                text-align: center;
                font-size: 1.8rem;
            }

            select {
                width: 100%;
                padding: 15px;
                border: 4px solid var(--neo-black);
                background: var(--neo-white);
                font-family: 'Bungee', cursive;
                font-size: 1rem;
                appearance: none;
                cursor: pointer;
            }

            .team-logo {
                width: 150px;
                height: 150px;
                margin: 20px auto;
                display: block;
                filter: drop-shadow(4px 4px 0px var(--neo-black));
            }

            .compare-btn {
                display: block;
                margin: 40px auto;
                padding: 20px 40px;
                background: var(--mlb-red);
                color: var(--neo-white);
                border: 4px solid var(--neo-black);
                box-shadow: var(--neo-shadow);
                font-family: 'Bungee', cursive;
                font-size: 1.5rem;
                cursor: pointer;
                transform: rotate(-2deg);
                transition: transform 0.2s, box-shadow 0.2s;
            }

            .compare-btn:hover {
                transform: rotate(-2deg) translate(4px, 4px);
                box-shadow: 4px 4px 0px rgba(0, 0, 0, 0.9);
            }

            .comparison-container {
                background: var(--neo-white);
                padding: 40px;
                border: 4px solid var(--neo-black);
                box-shadow: var(--neo-shadow);
                margin-top: 60px;
                position: relative;
                height: 500px;
                width: 85%;
                max-width: 1100px;
                margin-left: auto;
                margin-right: auto;
            }

            .comparison-container::before {
                content: '';
                position: absolute;
                top: -4px;
                left: -4px;
                right: -4px;
                bottom: -4px;
                border: 4px solid var(--neo-black);
                z-index: -1;
            }

            #comparisonChart {
                width: 90% ;
                height: 90%;
                margin: 0 auto;
                background: var(--neo-white);
            }


            .overall-score {
                font-family: 'Bungee', cursive;
                font-size: 2.5rem;
                text-align: center;
                margin-bottom: 20px;
                padding: 15px;
                background: var(--neo-white);
                border: 4px solid var(--neo-black);
                box-shadow: var(--neo-shadow);
            }            



            .visualization-buttons {
                display: flex;
                justify-content: center;
                gap: 20px;
                margin: 20px 0;
                flex-wrap: wrap;
            }
            
            .viz-btn {
                padding: 15px 25px;
                background: var(--mlb-blue);
                color: var(--neo-white);
                border: 4px solid var(--neo-black);
                box-shadow: var(--neo-shadow);
                font-family: 'Bungee', cursive;
                font-size: 1rem;
                cursor: pointer;
                transform: rotate(-1deg);
                transition: all 0.2s;
            }
            
            .viz-btn:hover {
                transform: rotate(1deg) translate(2px, 2px);
                box-shadow: 4px 4px 0px rgba(0, 0, 0, 0.9);
            }
            
            .viz-btn.active {
                background: var(--mlb-red);
                transform: translate(4px, 4px);
                box-shadow: none;
            }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Team Comparison</h1>
        </div>

        <div class="team-select-container">
            <div class="team-select">
                <h2>Home Team</h2>
                <img id="homeLogo" class="team-logo" src="" alt="Logo">
                <select id="homeTeam"></select>
            </div>

            <div class="team-select">
                <h2>Away Team</h2>
                <img id="awayLogo" class="team-logo" src="" alt="Logo">
                <select id="awayTeam"></select>
            </div>
        </div>

        <button class="compare-btn" onclick="compareTeams()">Compare Teams</button>

        <div class="comparison-container">
            <div class="overall-score">
                <span id="homeScore" style="color: var(--mlb-blue)">0</span>
                <span style="color: var(--neo-black)">-</span>
                <span id="awayScore" style="color: var(--mlb-red)">0</span>
            </div>
            <canvas id="comparisonChart"></canvas>
        </div>
    </div>

    <script>
        const teams = {
            "American League": {
                "East": [
                    {"name": "New York Yankees", "id": 147},
                    {"name": "Tampa Bay Rays", "id": 139},
                    {"name": "Boston Red Sox", "id": 111},
                    {"name": "Toronto Blue Jays", "id": 141},
                    {"name": "Baltimore Orioles", "id": 110}
                ],
                "Central": [
                    {"name": "Cleveland Guardians", "id": 114},
                    {"name": "Minnesota Twins", "id": 142},
                    {"name": "Chicago White Sox", "id": 145},
                    {"name": "Kansas City Royals", "id": 118},
                    {"name": "Detroit Tigers", "id": 116}
                ],
                "West": [
                    {"name": "Houston Astros", "id": 117},
                    {"name": "Texas Rangers", "id": 140},
                    {"name": "Oakland Athletics", "id": 133},
                    {"name": "Seattle Mariners", "id": 136},
                    {"name": "Los Angeles Angels", "id": 108}
                ]
            },
            "National League": {
                "East": [
                    {"name": "New York Mets", "id": 121},
                    {"name": "Washington Nationals", "id": 120},
                    {"name": "Atlanta Braves", "id": 144},
                    {"name": "Miami Marlins", "id": 146},
                    {"name": "Philadelphia Phillies", "id": 143}
                ],
                "Central": [
                    {"name": "St. Louis Cardinals", "id": 138},
                    {"name": "Cincinnati Reds", "id": 113},
                    {"name": "Pittsburgh Pirates", "id": 134},
                    {"name": "Chicago Cubs", "id": 112},
                    {"name": "Milwaukee Brewers", "id": 158}
                ],
                "West": [
                    {"name": "San Francisco Giants", "id": 137},
                    {"name": "San Diego Padres", "id": 135},
                    {"name": "Colorado Rockies", "id": 115},
                    {"name": "Arizona Diamondbacks", "id": 109},
                    {"name": "Los Angeles Dodgers", "id": 119}
                ]
            }
        };

        let chart = null;

        function calculateTeamScore(stats) {
            // Calculate batting and pitching out of 50 points each
            const battingScore = Math.abs(stats.batting / 100) * 50;
            const pitchingScore = Math.abs(stats.pitching / 100) * 50;
            
            return {
                batting: battingScore,
                pitching: pitchingScore,
                overall: battingScore + pitchingScore // This gives us a score out of 100
            };
        }

        async function compareTeams() {
            const homeTeam = document.getElementById('homeTeam').value;
            const awayTeam = document.getElementById('awayTeam').value;
            
            const formData = new FormData();
            formData.append('home_team', homeTeam);
            formData.append('away_team', awayTeam);
        
            try {
                const response = await fetch('/compare', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                
                // Transform the API data for visualization
                const transformedData = {
                    home: {
                        batting: data.home.batting.value,
                        pitching: data.home.pitching.value,
                        overall: (data.home.batting.value + data.home.pitching.value)
                    },
                    away: {
                        batting: data.away.pitching.value,
                        pitching: data.away.pitching.value,
                        overall: (data.away.batting.value + data.away.pitching.value)
                    }
                };
        
                // Update scores and chart
                document.getElementById('homeScore').textContent = Math.round(transformedData.home.overall);
                document.getElementById('awayScore').textContent = Math.round(transformedData.away.overall);
                
                // Update chart
                updateBarChart(transformedData);
                
                // Scroll to comparison
                document.querySelector('.comparison-container').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
                
            } catch (error) {
                console.error('Error comparing teams:', error);
                alert('Error comparing teams. Please try again.');
            }
        }     

        //visualizationfunctions
        // 1. Enhanced Bar Chart
        function updateBarChart(data) {
            document.getElementById('homeScore').textContent = data.home.overall.toFixed(1);
            document.getElementById('awayScore').textContent = data.away.overall.toFixed(1);

            if (chart) chart.destroy();
            
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Batting (50)', 'Pitching (50)'],
                    datasets: [{
                        label: 'Home Team',
                        data: [data.home.batting, data.home.pitching, data.home.overall],
                        backgroundColor: 'rgba(0, 45, 114, 0.8)',
                        borderColor: '#000000',
                        borderWidth: 4
                    }, {
                        label: 'Away Team',
                        data: [data.away.batting, data.away.pitching, data.away.overall],
                        backgroundColor: 'rgba(227, 24, 55, 0.8)',
                        borderColor: '#000000',
                        borderWidth: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                font: { family: 'Bungee', size: 16 },
                                color: '#000000'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.raw.toFixed(1)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 50,
                            grid: { color: '#000000', lineWidth: 2 },
                            ticks: {
                                callback: function(value) {
                                    return value.toFixed(0);
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeOutBounce'
                    }
                }
            });
        }
        

        function populateTeamSelects() {
            const homeSelect = document.getElementById('homeTeam');
            const awaySelect = document.getElementById('awayTeam');
            
            // Clear existing options
            homeSelect.innerHTML = '';
            awaySelect.innerHTML = '';
        
            // Add a default option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Select a team';
            homeSelect.appendChild(defaultOption.cloneNode(true));
            awaySelect.appendChild(defaultOption.cloneNode(true));
        
            for (const league in teams) {
                for (const division in teams[league]) {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = `${league} ${division}`;
        
                    teams[league][division].forEach(team => {
                        const option = document.createElement('option');
                        option.value = team.id;
                        option.textContent = team.name;
                        optgroup.appendChild(option.cloneNode(true));
                    });
        
                    homeSelect.appendChild(optgroup.cloneNode(true));
                    awaySelect.appendChild(optgroup);
                }
            }
        }

        function setDefaultTeam() {
            const yankeeId = '147';
            document.getElementById('homeTeam').value = yankeeId;
            document.getElementById('awayTeam').value = '139'; // Setting Rays as default away team
            updateTeamLogo('homeTeam');
            updateTeamLogo('awayTeam');
        }

        function updateTeamLogo(selectId) {
            const select = document.getElementById(selectId);
            const logoId = selectId === 'homeTeam' ? 'homeLogo' : 'awayLogo';
            const teamId = select.value;
            // Updated URL format for MLB team logos
            const logoUrl = `https://www.mlbstatic.com/team-logos/${teamId}.svg`;
            const logoImg = document.getElementById(logoId);
            logoImg.src = logoUrl;
            logoImg.onerror = function() {
                // Fallback if the logo fails to load
                this.src = 'https://www.mlbstatic.com/team-logos/league-on-dark/1.svg';
            };
        }

        document.getElementById('homeTeam').addEventListener('change', () => updateTeamLogo('homeTeam'));
        document.getElementById('awayTeam').addEventListener('change', () => updateTeamLogo('awayTeam'));

        // Initialize the team selects when the page loads
        populateTeamSelects();
        setDefaultTeam();
    </script>
</body>
</html>
