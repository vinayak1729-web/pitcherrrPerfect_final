<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pitcher Perfect - Baseball Team Selector</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
     <link href="https://fonts.googleapis.com/css2?family=Graduate&display=swap" rel="stylesheet">
     <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
   
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'lexus-blue': '#003DA5',
                        'lexus-red': '#D50032'
                    },
                    boxShadow: {
                        'neobrutalist': '0 8px 0 -2px rgba(0,0,0,0.2), 0 12px 20px rgba(0,0,0,0.15)',
                        'player-card': '6px 6px 0 rgba(0,0,0,0.2)'
                    }
                }
            }
        }
    </script>
    <style>
        .field-player {
            position: relative;
            width: 80px;
            height: 80px;
            margin: 20px;
            display: inline-block;
            perspective: 1000px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
        }

        .field-player img {
            width: 70px;
            height: 70px;
            object-fit: contain;
            border-radius: 8px;
            background: linear-gradient(135deg, #ffffff 0%, #e0e0e0 50%, #ffffff 100%);
            border: 3px solid #c0c0c0;
            padding: 2px;
            box-shadow:
                0 0 15px rgba(255, 0, 0, 0.6),
                0 0 30px rgba(0, 0, 255, 0.4),
                inset 0 0 10px rgba(255, 255, 255, 0.8);
            filter: brightness(1.1) contrast(1.1);
        }

        .player-name {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(90deg, #ff0000, #0066ff, #ff0000);
            background-size: 200% auto;
            padding: 3px 10px;
            border-radius: 15px;
            font-weight: 500;
            font-size: 0.9rem;
            color: #ffffff;
            text-shadow:
                0 0 5px rgba(255, 255, 255, 0.8),
                0 0 10px rgba(255, 255, 255, 0.4);
            z-index: 2;
            animation: gradientShift 3s linear infinite;
        }

        .player-info {
            position: absolute;
            bottom: -60px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            background: linear-gradient(135deg, #ff1a1a 0%, #0066ff 100%);
            padding: 10px;
            border-radius: 8px;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: center;
            color: #ffffff;
            box-shadow:
                0 0 20px rgba(192, 192, 192, 0.9),
                0 0 40px rgba(255, 255, 255, 0.5),
                inset 0 0 15px rgba(255, 255, 255, 0.5);
        }

        .field-player:hover {
            transform: scale(1.15) rotateY(10deg);
            z-index: 10;
        }

        .field-player:hover img {
            box-shadow:
                0 0 25px rgba(255, 0, 0, 0.8),
                0 0 50px rgba(0, 0, 255, 0.6),
                inset 0 0 15px rgba(255, 255, 255, 0.9);
            filter: brightness(1.2) contrast(1.2);
        }

        .field-player:hover .player-info {
            opacity: 1;
            bottom: -50px;
            transform: translateX(-50%) scale(1.1);
        }
        .download-btn {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            background: #003DA5;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }

        .download-btn:hover {
            background: #002a70;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        @keyframes holographicShine {
            0% {
                filter: hue-rotate(0deg) brightness(1);
            }

            50% {
                filter: hue-rotate(180deg) brightness(1.2);
            }

            100% {
                filter: hue-rotate(360deg) brightness(1);
            }
        }

        .field-player::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg,
                    transparent 0%,
                    rgba(255, 255, 255, 0.2) 45%,
                    rgba(255, 255, 255, 0.7) 50%,
                    rgba(255, 255, 255, 0.2) 55%,
                    transparent 100%);
            z-index: -1;
            animation: holographicShine 6s infinite linear;
            border-radius: 10px;
            pointer-events: none;
        }

        .players-container {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            padding: 30px;
            background: radial-gradient(circle, #2a2a2a 0%, #000000 100%);
        }

        /* Chrome-style text effect */
        .player-position {
            font-size: 0.8rem;
            margin-top: 4px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            background: linear-gradient(90deg, #fff, #c0c0c0, #fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: chromatic 4s linear infinite;
        }

        @keyframes chromatic {
            0% {
                filter: hue-rotate(0deg);
            }

            100% {
                filter: hue-rotate(360deg);
            }
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .stats-modal {
            animation: modalFadeIn 0.3s ease-out;
        }

        .stat-value {
            background: linear-gradient(90deg, #4299e1, #e53e3e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .team-header {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 15px;
        }

        .team-name {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(90deg, #ff0000, #0066ff, #ff0000);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 3s linear infinite;
            text-shadow:
                0 0 15px rgba(255, 255, 255, 0.4),
                0 0 30px rgba(255, 255, 255, 0.2);
        }

        .team-ovr {
            font-size: 2rem;
            font-weight: 700;
            padding: 8px 20px;
            border-radius: 15px;
            text-align: center;
            background: linear-gradient(135deg, #ff1a1a 0%, #0066ff 100%);
            color: #ffffff;
            box-shadow:
                0 0 20px rgba(192, 192, 192, 0.9),
                0 0 40px rgba(255, 255, 255, 0.5),
                inset 0 0 15px rgba(255, 255, 255, 0.5);
            text-shadow:
                0 0 5px rgba(255, 255, 255, 0.8),
                0 0 10px rgba(255, 255, 255, 0.4);
        }
        button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>

<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white font-sans" >
    <!-- Navbar -->
    <nav class="bg-lexus-blue dark:bg-gray-800 shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="baseball-font text-3xl neon-text">
                        <span class="text-lexus-red dark:text-lexus-red">Pitcher</span>
                        <span class="text-white dark:text-white">Perfect</span>
                    </div>
                </div>
                <div class="flex items-center space-x-8">
                    <a href="/"
                        class="text-white dark:text-white hover:text-lexus-red dark:hover:text-lexus-red transition-colors">Home</a>
                    <a href="/Chat_dashboard"
                        class="text-white dark:text-white hover:text-lexus-red dark:hover:text-lexus-red transition-colors">Fan
                        Link</a>
                    <a href="/yourteam"
                        class="text-white dark:text-white hover:text-lexus-red dark:hover:text-lexus-red transition-colors">Your
                        Team</a>
                    <a href="/profile"
                        class="text-white dark:text-white hover:text-lexus-red dark:hover:text-lexus-red transition-colors">Profile</a>
                    <button id="darkModeToggle"
                        class="text-white dark:text-white hover:text-lexus-red dark:hover:text-lexus-red transition-colors">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>
 
    <div class="container mx-auto px-4 py-8">
        <div id="bodymain">
            <div class="team-ovr-container text-center mb-8">
                <div class="inline-block bg-gradient-to-r from-lexus-red to-lexus-blue p-1 rounded-xl">
                    <div class="bg-white dark:bg-gray-900 px-8 py-4 rounded-lg">
                        <span
                            class="text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-lexus-red to-lexus-blue">
                            OVR: {{team_ovrs}}
                        </span>
                    </div>
                </div>
            </div>

            <div class="field-container max-w-5xl mx-auto relative">
                <!-- Baseball Field Image -->

                <img src="{{ url_for('static', filename='images/baseball.jpg') }}" alt="Baseball Field"
                    class="w-full rounded-2xl shadow-neobrutalist filter brightness-110 contrast-110">

                <div class="absolute inset-0" id="fieldPositions">
                    <div class="position-slot absolute top-[55%] left-[50%] -translate-x-1/2 -translate-y-1/2 "
                        data-position="Pitcher" id="pitcher">
                    </div>
                    <div class="position-slot absolute top-[93%] left-[50%] -translate-x-1/2 -translate-y-1/2 "
                        data-position="Catcher" id="catcher">
                    </div>
                    <div class="position-slot absolute top-[75%] left-[50%] -translate-x-1/2 -translate-y-1/2 "
                        data-position="Hitter" id="home-base">
                    </div>
                    <div class="position-slot absolute top-[55%] left-[69%] -translate-x-1/2 -translate-y-1/2 "
                        data-position="First Base" id="first-base">
                    </div>
                    <div class="position-slot absolute top-[31%] left-[50%] -translate-x-1/2 -translate-y-1/2 "
                        data-position="Second Base" id="second-base">
                    </div>
                    <div class="position-slot absolute top-[55%] left-[29%] -translate-x-1/2 -translate-y-1/2 "
                        data-position="Third Base" id="third-base">
                    </div>
                    <div class="position-slot absolute top-[26%] left-[35%] -translate-x-1/2 -translate-y-1/2 "
                        data-position="Shortstop" id="shortstop">
                    </div>
                    <div class="position-slot absolute top-[9%] left-[50%] -translate-x-1/2 -translate-y-1/2 "
                        data-position="Outfielder" id="center-field">
                    </div>
                    <div class="position-slot absolute top-[25%] left-[20%] -translate-x-1/2 -translate-y-1/2 "
                        data-position="Outfielder" id="left-field">
                    </div>
                    <div class="position-slot absolute top-[25%] left-[80%] -translate-x-1/2 -translate-y-1/2 "
                        data-position="Outfielder" id="right-field">
                    </div>
                </div>
            </div>
        </div>

   
    <div class="max-w-xl mx-auto mt-8 flex space-x-4">
        <select id="teamSelect" class="flex-grow bg-white dark:bg-gray-800 text-lexus-blue dark:text-white 
                       p-3 rounded-lg border-4 border-lexus-blue dark:border-lexus-blue 
                       focus:ring-2 focus:ring-lexus-red transition shadow-player-card">
            <option value="">-- Select a Team --</option>
            {% for team_name in team_names %}
            <option value="{{ team_name }}">{{ team_name }}</option>
            {% endfor %}
        </select>
        <button id="selectTeamBtn" class="bg-lexus-red hover:bg-lexus-red/80 text-white font-bold py-3 px-6 
                       rounded-lg transition transform hover:-translate-y-1 
                       shadow-player-card border-4 border-lexus-blue 
                       dark:border-lexus-blue active:translate-y-1">
            Select Team
        </button>
    </div>

    <!-- Player Bench -->
    <div class="mt-8 max-w-6xl mx-auto">
        <h2 class="text-3xl font-bold mb-6 text-center text-lexus-red dark:text-lexus-red">
            <div class="team-name">{{team_name}}</div>
        </h2>
        <div id="playerContainer" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6">
            <!-- Players will be loaded here dynamically -->
        </div>
    </div>
    </div>
    </div>
    <script>
        const teamsPlayersData = {{ teams_players| tojson }};
        const selectTeamBtn = document.getElementById('selectTeamBtn');
        const teamSelect = document.getElementById('teamSelect');
        const playerContainer = document.getElementById('playerContainer');
        const fieldPositions = document.getElementById('fieldPositions');
        const positionSlots = document.querySelectorAll('.position-slot');
        let draggedCard = null;

        // Add click event listener to player cards
        function addPlayerStatsClickHandler() {
            const playerCards = document.querySelectorAll('.field-player');

            playerCards.forEach(card => {
                card.addEventListener('click', async function () {
                    const playerId = this.getAttribute('data-player-id');
                    try {
                        const response = await fetch(`/player_stats/${playerId}`);
                        const statsData = await response.json();

                        displayPlayerStats({
                            name: this.querySelector('.player-name').textContent,
                            position: this.querySelector('.player-position').textContent,
                            ovr: this.querySelector('.ovr-rating')?.textContent || 'N/A',
                            stats: statsData
                        });
                    } catch (error) {
                        console.error('Error fetching player stats:', error);
                    }
                });
            });
        }

        // Update your createFieldPlayer function
        function createFieldPlayer(player) {
            const fieldPlayer = document.createElement('div');
            fieldPlayer.className = 'field-player';
            fieldPlayer.setAttribute('data-player-id', player.id); // Make sure to add player ID

            fieldPlayer.innerHTML = `
        <div class="ovr-rating">${player.ovr !== 'N/A' ? player.ovr.toFixed(1) : 'N/A'}</div>
        <div class="player-image-container">
            <img src="${player.headshot_url}" alt="${player.name}" />
        </div>
        <div class="player-info">
            <div class="player-name">${player.name}</div>
            <div class="player-position">${player.position}</div>
        </div>
    `;

            // Add click handler for stats
            fieldPlayer.addEventListener('click', async function () {
                try {
                    const response = await fetch(`/player_stats/${player.id}`);
                    const statsData = await response.json();

                    displayPlayerStats({
                        name: player.name,
                        position: player.position,
                        ovr: player.ovr,
                        stats: statsData
                    });
                } catch (error) {
                    console.error('Error fetching player stats:', error);
                }
            });

            return fieldPlayer;
        }

        // Call this after loading players
        function initializePlayerCards() {
            loadTeamPlayers(selectedTeam);
            addPlayerStatsClickHandler();
        }


        function createFieldPlayer(player) {
            const fieldPlayer = document.createElement('div');
            fieldPlayer.className = 'field-player';
            fieldPlayer.innerHTML = `
        <div class="ovr-rating">${player.ovr !== 'N/A' ? player.ovr.toFixed(1) : 'N/A'}</div>
        <div class="player-image-container">
            <img src="${player.headshot_url}" 
                 alt="${player.name}" 
            />
        </div>
        <div class="player-info">
            <div class="player-name">${player.name}</div>
            <div class="player-position">${player.position}</div>
        </div>
    `;
            return fieldPlayer;
        }

        document.addEventListener('DOMContentLoaded', function () {
            const teamSelect = document.getElementById('teamSelect');
            const positionSlots = document.querySelectorAll('.position-slot');
            const usedPlayers = new Set();

            function canPlayHomeBase(playerPosition) {
                const validHitterPositions = [
                    "Two-Way Player",  // Highest priority
                    "Designated Hitter",
                    "First Base",
                    "Second Base",
                    "Third Base",
                    "Shortstop",
                    "Outfielder"
                ];
                return validHitterPositions.includes(playerPosition);
            }

            function canPlayerPlayPosition(playerPosition, slotPosition) {
                if (slotPosition === "Hitter") {
                    return canPlayHomeBase(playerPosition);
                }
                if (slotPosition === "Outfielder") {
                    return playerPosition === "Outfielder";
                }
                return playerPosition === slotPosition;
            }

            positionSlots.forEach(position => {
                position.addEventListener('dragover', (e) => e.preventDefault());
                position.addEventListener('drop', () => {
                    if (draggedCard) {
                        const playerPosition = draggedCard.getAttribute('data-position');
                        const slotPosition = position.getAttribute('data-position');
                        const playerName = draggedCard.querySelector('.text-lg').textContent;

                        if (usedPlayers.has(playerName)) {
                            alert(`${playerName} is already on the field!`);
                            return;
                        }

                        if (canPlayerPlayPosition(playerPosition, slotPosition)) {
                            position.innerHTML = '';
                            const fieldPlayer = createFieldPlayer({
                                name: playerName,
                                headshot_url: draggedCard.querySelector('img').src,
                                position: playerPosition
                            });
                            position.appendChild(fieldPlayer);
                            position.classList.add('has-player');
                            usedPlayers.add(playerName);
                            draggedCard.remove();
                        } else {
                            alert(`This player cannot play in the ${slotPosition} position!`);
                        }
                    }
                });
            });

            function updatePositionPlayers(teamName) {
                usedPlayers.clear();

                // First fetch Two-Way Players for home base
                fetch(`/get_position_headshots/${teamName}/Two-Way Player`)
                    .then(res => res.json())
                    .then(twoWayData => {
                        const twoWayPlayers = twoWayData.players || [];

                        // Then fetch other positions
                        return Promise.all([
                            Promise.resolve(twoWayPlayers),
                            fetch(`/get_position_headshots/${teamName}/Outfielder`).then(res => res.json()),
                            fetch(`/get_position_headshots/${teamName}/First Base`).then(res => res.json()),
                            fetch(`/get_position_headshots/${teamName}/Second Base`).then(res => res.json()),
                            fetch(`/get_position_headshots/${teamName}/Third Base`).then(res => res.json()),
                            fetch(`/get_position_headshots/${teamName}/Shortstop`).then(res => res.json()),
                            fetch(`/get_position_headshots/${teamName}/Designated Hitter`).then(res => res.json())
                        ]);
                    })
                    .then(([twoWayPlayers, outfieldData, ...otherPositions]) => {
                        const outfielders = outfieldData.players || [];
                        const potentialHitters = [];

                        // Add players to potential hitters in priority order
                        if (twoWayPlayers.length > 0) {
                            potentialHitters.push(...twoWayPlayers);
                        }
                        otherPositions.forEach(data => {
                            if (data.players) {
                                potentialHitters.push(...data.players);
                            }
                        });

                        positionSlots.forEach((slot) => {
                            const position = slot.getAttribute('data-position');

                            if (position === 'Outfielder') {
                                const outfielder = outfielders.find(player => !usedPlayers.has(player.name));
                                if (outfielder) {
                                    slot.innerHTML = createPlayerHTML(outfielder);
                                    usedPlayers.add(outfielder.name);
                                }
                            } else if (position === 'Hitter') {
                                const hitter = potentialHitters.find(player => !usedPlayers.has(player.name));
                                if (hitter) {
                                    slot.innerHTML = createPlayerHTML(hitter);
                                    usedPlayers.add(hitter.name);
                                }
                            } else {
                                fetch(`/get_position_headshots/${teamName}/${position}`)
                                    .then(response => response.json())
                                    .then(data => {
                                        if (data.players && data.players.length > 0) {
                                            const player = data.players[0];
                                            if (!usedPlayers.has(player.name)) {
                                                slot.innerHTML = createPlayerHTML(player);
                                                usedPlayers.add(player.name);
                                            }
                                        } else {
                                            slot.innerHTML = position;
                                        }
                                    });
                            }
                        });
                    });
            }

            function createPlayerHTML(player) {
                return `
            <div class="field-player">
    <span class="player-name">${player.ovr || 'N/A'}</span>
    <img src="${player.headshot_url}" alt="${player.name}"/>
    <div class="player-info">
        <div class="player-name">${player.name}</div><br>
        <div class="player-position">${player.position}</div>
    </div>
</div>

        `;
            }

            teamSelect.addEventListener('change', function () {
                const selectedTeam = this.value;
                if (selectedTeam) {
                    updatePositionPlayers(selectedTeam);
                }
            });

            if (teamSelect.options.length > 1) {
                updatePositionPlayers(teamSelect.options[1].value);
            }
        });
        document.addEventListener('DOMContentLoaded', function () {
            const teamSelect = document.getElementById('teamSelect');
            const positionSlots = document.querySelectorAll('.position-slot');
            const usedPlayers = new Set(); // Track used players

            function canPlayHomeBase(playerPosition) {
                const validHitterPositions = [
                    "First Base",
                    "Second Base",
                    "Third Base",
                    "Shortstop",
                    "Outfielder",
                    "Two-Way Player",
                    "Designated Hitter"
                ];
                return validHitterPositions.includes(playerPosition);
            }

            function canPlayerPlayPosition(playerPosition, slotPosition) {
                if (slotPosition === "Hitter") {
                    return canPlayHomeBase(playerPosition);
                }
                if (slotPosition === "Outfielder") {
                    return playerPosition === "Outfielder";
                }
                return playerPosition === slotPosition;
            }

            positionSlots.forEach(position => {
                position.addEventListener('dragover', (e) => e.preventDefault());

                position.addEventListener('drop', () => {
                    if (draggedCard) {
                        const playerPosition = draggedCard.getAttribute('data-position');
                        const slotPosition = position.getAttribute('data-position');
                        const playerName = draggedCard.querySelector('.text-lg').textContent;

                        if (usedPlayers.has(playerName)) {
                            alert(`${playerName} is already on the field!`);
                            return;
                        }

                        if (canPlayerPlayPosition(playerPosition, slotPosition)) {
                            position.innerHTML = '';
                            const fieldPlayer = createFieldPlayer({
                                name: playerName,
                                headshot_url: draggedCard.querySelector('img').src,
                                position: playerPosition
                            });
                            position.appendChild(fieldPlayer);
                            position.classList.add('has-player');
                            usedPlayers.add(playerName);
                            draggedCard.remove();
                        } else {
                            alert(`This player cannot play in the ${slotPosition} position!`);
                        }
                    }
                });
            });

            function updatePositionPlayers(teamName) {
                usedPlayers.clear();
                let outfielders = [];
                let potentialHitters = []; // Store potential hitters

                // Collect outfielders and potential hitters
                Promise.all([
                    fetch(`/get_position_headshots/${teamName}/Outfielder`).then(res => res.json()),
                    fetch(`/get_position_headshots/${teamName}/First Base`).then(res => res.json()),
                    fetch(`/get_position_headshots/${teamName}/Second Base`).then(res => res.json()),
                    fetch(`/get_position_headshots/${teamName}/Third Base`).then(res => res.json()),
                    fetch(`/get_position_headshots/${teamName}/Shortstop`).then(res => res.json())
                ]).then(([outfieldData, ...infieldData]) => {
                    outfielders = outfieldData.players || [];
                    infieldData.forEach(data => {
                        if (data.players) {
                            potentialHitters.push(...data.players);
                        }
                    });

                    positionSlots.forEach((slot, index) => {
                        const position = slot.getAttribute('data-position');

                        if (position === 'Outfielder') {
                            const outfielder = outfielders.find(player => !usedPlayers.has(player.name));
                            if (outfielder) {
                                slot.innerHTML = `
                            <div class="field-player">
                                <img src="${outfielder.headshot_url}" 
                                     alt="${outfielder.name}" 
                                     class="w-16 h-16 rounded-full border-2 border-yellow-400"
                                />
                                <span class="player-name">${outfielder.name}</span>
                            </div>
                        `;
                                usedPlayers.add(outfielder.name);
                            }
                        } else if (position === 'Hitter') {
                            const hitter = potentialHitters.find(player => !usedPlayers.has(player.name));
                            if (hitter) {
                                slot.innerHTML = `
                            <div class="field-player">
                                <img src="${hitter.headshot_url}" 
                                     alt="${hitter.name}" 
                                     class="w-16 h-16 rounded-full border-2 border-yellow-400"
                                />
                                <span class="player-name">${hitter.name}</span>
                            </div>
                        `;
                                usedPlayers.add(hitter.name);
                            }
                        } else {
                            fetch(`/get_position_headshots/${teamName}/${position}`)
                                .then(response => response.json())
                                .then(data => {
                                    if (data.players && data.players.length > 0) {
                                        const player = data.players[0];
                                        if (!usedPlayers.has(player.name)) {
                                            slot.innerHTML = `
                                        <div class="field-player">
                                            <img src="${player.headshot_url}" 
                                                 alt="${player.name}" 
                                                 class="w-16 h-16 rounded-full border-2 border-yellow-400"
                                            />
                                            <span class="player-name">${player.name}</span>
                                        </div>
                                    `;
                                            usedPlayers.add(player.name);
                                        }
                                    } else {
                                        slot.innerHTML = position;
                                    }
                                });
                        }
                    });
                });
            }

            teamSelect.addEventListener('change', function () {
                const selectedTeam = this.value;
                if (selectedTeam) {
                    updatePositionPlayers(selectedTeam);
                }
            });

            if (teamSelect.options.length > 1) {
                updatePositionPlayers(teamSelect.options[1].value);
            }
        });




        function loadTeamPlayers(teamName) {
            playerContainer.innerHTML = '';
            // Replace the existing drop event listener with this code
            positionSlots.forEach(position => {
                position.addEventListener('dragover', (e) => e.preventDefault());

                position.addEventListener('drop', () => {
                    if (draggedCard) {
                        const playerPosition = draggedCard.getAttribute('data-position');
                        const slotPosition = position.getAttribute('data-position');

                        if (playerPosition === slotPosition || slotPosition === 'Hitter') {
                            // Clear existing content
                            position.innerHTML = '';

                            // Get player details
                            const playerName = draggedCard.querySelector('.text-lg').textContent;
                            const playerImage = draggedCard.querySelector('img').src;

                            // Create field player element
                            const fieldPlayer = document.createElement('div');
                            fieldPlayer.className = 'field-player';
                            fieldPlayer.innerHTML = `
                    <img src="${playerImage}" alt="${playerName}">
                    <div class="player-name">${playerName}</div>
                `;

                            position.appendChild(fieldPlayer);
                            position.classList.add('has-player');

                            // Remove from player container
                            draggedCard.remove();
                        } else {
                            alert(`This player cannot play in the ${slotPosition} position!`);
                        }
                    }
                });
            });

            if (teamName && teamsPlayersData[teamName]) {
                teamsPlayersData[teamName].forEach(player => {
                    const playerCard = document.createElement('div');
                    playerCard.className = 'bg-fifa-gradient p-4 rounded-2xl shadow-fifa-card transform transition hover:-translate-y-2 cursor-grab relative overflow-hidden';
                    playerCard.draggable = true;
                    playerCard.setAttribute('data-position', player.position);
                    const ovrDisplay = player.ovr !== 'N/A' ? player.ovr.toFixed(1) : 'N/A';
                    playerCard.innerHTML = `
                        <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-tr from-white/10 to-transparent opacity-20 pointer-events-none"></div>
                        <div class="flex flex-col items-center">
                            <div class="text-yellow-400 font-bold text-xl mb-2">OVR: ${ovrDisplay}</div>
                            <img src="${player.headshot_url}" alt="${player.name}" class="w-32 h-32 rounded-full object-cover border-4 border-yellow-400 mb-3 shadow-lg">
                            <div class="text-lg font-bold text-white mb-2">${player.name}</div>
                            <div class="bg-black/30 text-white px-3 py-1 rounded-full text-xs uppercase tracking-wider">${player.position}</div>
                        </div>
                    `;

                    playerCard.addEventListener('dragstart', (e) => {
                        draggedCard = playerCard;
                        playerCard.classList.add('opacity-50', 'scale-95');
                    });

                    playerCard.addEventListener('dragend', () => {
                        draggedCard = null;
                        playerCard.classList.remove('opacity-50', 'scale-95');
                    });

                    playerContainer.appendChild(playerCard);
                });
            }
        }

        selectTeamBtn.addEventListener('click', () => {
            const selectedTeam = teamSelect.value;
            loadTeamPlayers(selectedTeam);
        });

        positionSlots.forEach(position => {
            position.addEventListener('dragover', (e) => e.preventDefault());

            position.addEventListener('drop', () => {
                if (draggedCard) {
                    // Check if player's position matches the slot
                    const playerPosition = draggedCard.getAttribute('data-position');
                    const slotPosition = position.getAttribute('data-position');

                    if (playerPosition === slotPosition || slotPosition === 'Hitter') {
                        // Clear existing content
                        position.innerHTML = '';

                        // Create a full player card in the position
                        const fullPlayerCard = document.createElement('div');
                        fullPlayerCard.className = 'flex flex-col items-center text-center';
                        fullPlayerCard.innerHTML = `
                        <img src="${draggedCard.querySelector('img').src}" 
                             class="w-24 h-24 rounded-full object-cover border-4 border-yellow-400 mb-2">
                        <div class="text-sm font-bold">${draggedCard.querySelector('div:nth-child(2)').textContent}</div>
                        <div class="text-xs text-gray-300">${draggedCard.querySelector('div:nth-child(3)').textContent}</div>
                    `;

                        // Create and add field player
                        const fieldPlayer = createFieldPlayer({
                            name: draggedCard.querySelector('div:nth-child(2)').textContent,
                            headshot_url: draggedCard.querySelector('img').src,
                            position: draggedCard.querySelector('div:nth-child(3)').textContent
                        });
                        position.appendChild(fieldPlayer);
                        position.appendChild(fullPlayerCard);
                        position.classList.add('has-player');

                        // Remove from player container
                        draggedCard.remove();
                    } else {
                        alert(`This player cannot play in the ${slotPosition} position!`);
                    }
                }
            });
        });
        // Add dark mode toggle functionality
        const darkModeToggle = document.getElementById('darkModeToggle');
        darkModeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
        });

        // Add sidebar toggle functionality
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');
        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
        });

        document.getElementById('downloadBtn').addEventListener('click', function () {
            const element = document.getElementById('bodymain'); // Element to capture

            html2canvas(element).then(canvas => {
                const imgData = canvas.toDataURL('image/png'); // Convert content to an image
                const pdf = new jspdf.jsPDF('p', 'mm', 'a4'); // Create a new jsPDF instance

                // Get the dimensions of A4 (210mm x 297mm) in pixels
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();

                // Calculate aspect ratio for image scaling
                const imgWidth = pageWidth;
                const imgHeight = (canvas.height * pageWidth) / canvas.width;

                pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight); // Add the image to the PDF

                pdf.save('webpage_content.pdf'); // Save the PDF with the given name
            }).catch(err => {
                console.error('Failed to capture and generate PDF:', err);
            });
        });
        // Add hover effect to player cards
        document.querySelectorAll('.player-card').forEach(card => {
            card.addEventListener('mouseover', () => {
                card.style.zIndex = '100';
            });
            card.addEventListener('mouseout', () => {
                card.style.zIndex = '1';
            });
        });

        // Function to update player information (can be used to load real data)
        function updatePlayer(position, name, rating, imageUrl) {
            const playerCard = document.getElementById(position);
            if (playerCard) {
                playerCard.querySelector('.player-name').textContent = name;
                playerCard.querySelector('.player-rating').textContent = rating;
                playerCard.querySelector('.player-image').src = imageUrl;
            }
        }
    </script>
</body>

</html>